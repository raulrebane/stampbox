-- Function: ds.fn_make_transaction(character varying, character varying, character varying, timestamp without time zone)

-- DROP FUNCTION ds.fn_make_transaction(character varying, character varying, character varying, timestamp without time zone);

CREATE OR REPLACE FUNCTION ds.fn_make_transaction(from_email character varying, to_email character varying, subject character varying, message_id character varying, e_mail_timestamp timestamp without time zone)
  RETURNS boolean AS
$BODY$
DECLARE 
  from_customer bigint;
  to_customer bigint;
begin
  
  SELECT customer_id into from_customer FROM ds.v_registered_email where username = from_email;
  IF NOT FOUND THEN
    RETURN FALSE;
  END IF;
  SELECT customer_id into to_customer FROM ds.v_registered_email where username = to_email;
  IF NOT FOUND THEN
    RETURN FALSE;
  END IF;
  
end;$BODY$
  LANGUAGE plpgsql VOLATILE
  COST 100;
ALTER FUNCTION ds.fn_make_transaction(character varying, character varying, character varying, character varying, timestamp without time zone)
  OWNER TO postgres;
